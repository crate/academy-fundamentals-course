<p>This exercise requires a CrateDB cluster with the course dataset loaded.&nbsp; If you didn't create your cluster earlier in the course, complete <a href="/cratedb-fundamentals?lesson=handson-your-first-cratedb-cluster" rel="noopener" target="_blank">these steps</a> before going further.</p>
<hr>
<p>It’s your turn to try out some Geospatial queries in your own CrateDB cluster. Open your cluster’s console and let’s dive in…</p>
<p>First, try running this query to determine how many of each type of 311 call was made from an area close to O’Hare airport:</p>
<pre>SELECT srtype, count(*) AS num_calls <br>FROM three_eleven_calls <br>WHERE within(<br>  locationdetails['location'], <br>  'POLYGON ((-88.021774 41.905854, -88.021774 42.068155, -87.782822 42.068155, -87.782822 41.905854, -88.021774 41.905854))') <br>GROUP BY srtype ORDER BY num_calls DESC;</pre>
<p>This query returns the names and populations of community areas that a flight path from O’Hare airport to Midway airport passes over:</p>
<pre>SELECT<br>&nbsp;&nbsp; name,<br> &nbsp; details['population'] as population<br>FROM community_areas<br>WHERE<br>&nbsp;&nbsp; intersects (<br>&nbsp;&nbsp; 'LINESTRING (-87.90753846894022 41.9807787186139, -87.72939445102593 41.97508268795004, -87.55763552335945 41.97982941555023, -87.47846040428642 41.92427055787562, -87.51102436455034 41.837749425166244, -87.59225264192574 41.80057450627759, -87.64801197528328 41.770600684095974, -87.69988112259261 41.7819633786835, -87.7530469985847 41.78583107072223)',<br>&nbsp;&nbsp; boundaries<br>&nbsp;&nbsp; )<br>AND details['population'] &gt; 30000<br>ORDER BY population DESC;</pre>
<p>Now spend a few moments composing some queries of your own, or running the examples above with different criteria. Use the <a href="https://cratedb.com/docs/crate/reference/en/latest/general/dql/geo.html#sql-dql-geo-search">CrateDB Geo search documentation</a> as your guide.</p>
<p>When writing your own Geospatial queries, it’s useful to be able to build up GeoJSON or WKT geometries interactively. The <a href="https://geojson.io/">geojson.io</a> tool is excellent for this. Use it to create geometries for your own queries and have fun exploring the dataset.</p>
<p>Don’t forget that you can find geospatial data in the <span style="font-family: terminal, monospace;">three_eleven_calls</span> table:</p>
<pre>SELECT srtype, locationdetails['location'] AS location <br>FROM three_eleven_calls WHERE srnumber='SR24-00581646';</pre>
<p>As well as in the <span style="font-family: terminal, monospace;">community_areas</span>:</p>
<pre>SELECT boundaries from community_areas WHERE name='CHATHAM';</pre>
<p>And <span style="font-family: terminal, monospace;">taxi_rides</span>:</p>
<pre>SELECT pickupcentroidlocation, dropoffcentroidlocation <br>FROM taxi_rides <br>WHERE tripid='b55b017e464858b1f39d9aaea1cc68acbc9f96db';</pre>
<p>&nbsp;</p>